<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Procesador de Excel</title>
    <!-- <link rel="stylesheet" href="styles.css"> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>

<style>
  * {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
  background-color: #f8fafc;
  color: #334155;
  line-height: 1.6;
}

.hidden {
  display: none !important;
}

/* Upload Screen Styles */
.upload-container {
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1rem;
}

.card {
  background: white;
  border-radius: 12px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 28rem;
  overflow: hidden;
}

.card-header {
  padding: 1.5rem;
  border-bottom: 1px solid #e2e8f0;
  text-align: center;
}

.card-header h1 {
  font-size: 1.5rem;
  font-weight: 700;
  color: #1e293b;
}

.card-content {
  padding: 1.5rem;
  display: flex;
  flex-direction: column;
  gap: 1.5rem;
}

.upload-section {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.upload-section label {
  font-weight: 500;
  color: #374151;
}

.dropzone {
  border: 2px dashed #d1d5db;
  border-radius: 8px;
  padding: 2rem;
  text-align: center;
  transition: all 0.2s;
  cursor: pointer;
}

.dropzone:hover {
  border-color: #3b82f6;
}

.dropzone.drag-over {
  border-color: #3b82f6;
  background-color: rgba(59, 130, 246, 0.1);
}

.dropzone-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 1rem;
}

.icon-container {
  padding: 1rem;
  background-color: #f1f5f9;
  border-radius: 50%;
}

.icon {
  width: 2rem;
  height: 2rem;
  color: #64748b;
}

.file-info .main-text {
  font-weight: 500;
  color: #1e293b;
}

.file-info .sub-text {
  font-size: 0.875rem;
  color: #64748b;
}

.btn-outline {
  padding: 0.5rem 1rem;
  border: 1px solid #d1d5db;
  background: white;
  border-radius: 6px;
  cursor: pointer;
  transition: all 0.2s;
}

.btn-outline:hover {
  background-color: #f8fafc;
}

.btn-primary {
  width: 100%;
  padding: 0.75rem 1.5rem;
  background-color: #3b82f6;
  color: white;
  border: none;
  border-radius: 6px;
  font-weight: 500;
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.btn-primary:hover:not(:disabled) {
  background-color: #2563eb;
}

.btn-primary:disabled {
  background-color: #94a3b8;
  cursor: not-allowed;
}

/* Table Screen Styles */
.table-container {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background-color: white;
}

.table-header {
  padding: 1rem 2rem;
  border-bottom: 1px solid #e2e8f0;
  background-color: #f8fafc;
}

.table-header h1 {
  font-size: 1.5rem;
  font-weight: 700;
  text-align: center;
  color: #1e293b;
}

.table-wrapper {
  flex: 1;
  overflow: auto;
  position: relative;
}

.data-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.875rem;
}

.data-table th {
  background-color: #f1f5f9;
  padding: 0.75rem;
  text-align: left;
  font-weight: 600;
  border: 1px solid #e2e8f0;
  position: sticky;
  top: 0;
  z-index: 10;
  min-width: 20px;
  max-width: 300px;
  resize: horizontal;
  overflow: hidden;
  position: relative;
  user-select: none;
}

.data-table th:hover {
  background-color: #e2e8f0;
}

.data-table td {
  border: 1px solid #e2e8f0;
  padding: 0;
  position: relative;
}

.data-table tr:hover {
  background-color: rgba(248, 250, 252, 0.5);
}

.cell-input {
  width: 100%;
  height: 100%;
  border: none;
  background: transparent;
  padding: 0.5rem;
  font-size: 0.875rem;
  outline: none;
  min-height: 2rem;
}

.cell-input:focus {
  background-color: #fef3c7;
  outline: 2px solid #f59e0b;
}

.table-footer {
  padding: 1.5rem 2rem;
  border-top: 1px solid #e2e8f0;
  background-color: #f8fafc;
  display: flex;
  justify-content: center;
}

.table-footer .btn-primary {
  width: auto;
  min-width: 200px;
}

.icon-small {
  width: 1rem;
  height: 1rem;
}

/* Resizable columns */
.resize-handle {
  position: absolute;
  top: 0;
  right: 0;
  width: 5px;
  height: 100%;
  cursor: col-resize;
  background: transparent;
}

.resize-handle:hover {
  background-color: #3b82f6;
}

/* Responsive */
@media (max-width: 768px) {
  .table-header,
  .table-footer {
    padding: 1rem;
  }

  .data-table {
    font-size: 0.75rem;
  }

  .data-table th {
    min-width: 100px;
    padding: 0.5rem;
  }

  .cell-input {
    padding: 0.25rem;
    font-size: 0.75rem;
  }
}

</style>

<body>
    <!-- Pantalla inicial con dropzone -->
    <div id="upload-screen" class="upload-container">
        <div class="card">
            <div class="card-header">
                <h1>Procesador de Excel</h1>
            </div>
            <div class="card-content">
                <div class="upload-section">
                    <label for="file-upload">Subir archivo Excel</label>
                    <div id="dropzone" class="dropzone">
                        <div class="dropzone-content">
                            <div class="icon-container">
                                <svg id="upload-icon" class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                                    <polyline points="7,10 12,15 17,10"/>
                                    <line x1="12" y1="15" x2="12" y2="3"/>
                                </svg>
                                <svg id="file-icon" class="icon hidden" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                    <path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/>
                                    <polyline points="14,2 14,8 20,8"/>
                                    <path d="M12 18v-6"/>
                                    <path d="m9 15 3 3 3-3"/>
                                </svg>
                            </div>
                            <div id="file-info" class="file-info">
                                <p class="main-text">Arrastra tu archivo Excel aquí</p>
                                <p class="sub-text">o haz clic para seleccionar</p>
                            </div>
                            <input type="file" id="file-upload" accept=".xlsx,.xls" hidden>
                            <button type="button" class="btn-outline" onclick="document.getElementById('file-upload').click()">
                                Seleccionar Archivo
                            </button>
                        </div>
                    </div>
                </div>
                <button id="process-btn" class="btn-primary" disabled>Procesar Excel</button>
            </div>
        </div>
    </div>

    <!-- Pantalla de tabla editable -->
    <div id="table-screen" class="table-container hidden">
        <div class="table-header">
            <h1>Datos del Excel - Tabla Editable</h1>
        </div>
        <div class="table-wrapper">
            <table id="data-table" class="data-table">
                <thead id="table-head"></thead>
                <tbody id="table-body"></tbody>
            </table>
        </div>
        <div class="table-footer">
            <button id="send-btn" class="btn-primary">
                <svg class="icon-small" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <line x1="22" y1="2" x2="11" y2="13"/>
                    <polygon points="22,2 15,22 11,13 2,9 22,2"/>
                </svg>
                Enviar Información
            </button>
        </div>
    </div>

    <!-- <script src="script.js"></script> -->
</body>


<script>
  // Variables globales
let currentFile = null
let employeeData = []
// const XLSX = window.XLSX // Declare the XLSX variable

// Elementos del DOM
const uploadScreen = document.getElementById("upload-screen")
const tableScreen = document.getElementById("table-screen")
const dropzone = document.getElementById("dropzone")
const fileUpload = document.getElementById("file-upload")
const processBtn = document.getElementById("process-btn")
const sendBtn = document.getElementById("send-btn")
const uploadIcon = document.getElementById("upload-icon")
const fileIcon = document.getElementById("file-icon")
const fileInfo = document.getElementById("file-info")
const dataTable = document.getElementById("data-table")
const tableHead = document.getElementById("table-head")
const tableBody = document.getElementById("table-body")

// Campos requeridos
const requiredFields = [
  "CLAVE",
  "NOMBRE",
  "NSS",
  "PUESTO",
  "ALTA",
  "DEPARTAMENTO",
  "CORREO ELECTRONICO",
  "ESTADO CIVIL",
  "CURP",
  "RFC",
  "CALLE # NUMERO, COLONIA",
  "POBLACION O MUNICIPIO",
  "ESTADO",
  "C.P",
  "TELEFONO",
  "FONACOT",
  "INFONAVIT",
  "F. NACIMIENTO",
  "C. NACIMIENTO",
  "REGIÓN",
]

// Event listeners para drag and drop
dropzone.addEventListener("dragover", handleDragOver)
dropzone.addEventListener("dragleave", handleDragLeave)
dropzone.addEventListener("drop", handleDrop)
dropzone.addEventListener("click", () => fileUpload.click())

// Event listener para selección de archivo
fileUpload.addEventListener("change", handleFileSelect)

// Event listeners para botones
processBtn.addEventListener("click", processExcel)
sendBtn.addEventListener("click", sendData)

// Funciones de drag and drop
function handleDragOver(e) {
  e.preventDefault()
  dropzone.classList.add("drag-over")
}

function handleDragLeave(e) {
  e.preventDefault()
  dropzone.classList.remove("drag-over")
}

function handleDrop(e) {
  e.preventDefault()
  dropzone.classList.remove("drag-over")

  const droppedFile = e.dataTransfer.files[0]
  if (
    droppedFile &&
    (droppedFile.type === "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet" ||
      droppedFile.name.endsWith(".xlsx"))
  ) {
    setFile(droppedFile)
  }
}

function handleFileSelect(e) {
  const selectedFile = e.target.files[0]
  if (selectedFile) {
    setFile(selectedFile)
  }
}

function setFile(file) {
  currentFile = file

  // Actualizar UI
  uploadIcon.classList.add("hidden")
  fileIcon.classList.remove("hidden")

  fileInfo.innerHTML = `
        <p class="main-text">${file.name}</p>
        <p class="sub-text">${(file.size / 1024 / 1024).toFixed(2)} MB</p>
    `

  processBtn.disabled = false
}

function processExcel() {
  if (!currentFile) return

  const reader = new FileReader()
  reader.onload = (e) => {
    try {
      const data = new Uint8Array(e.target.result)
      const workbook = XLSX.read(data, { type: "array" })
      const sheetName = workbook.SheetNames[0]
      const worksheet = workbook.Sheets[sheetName]
      const jsonData = XLSX.utils.sheet_to_json(worksheet)

      // Procesar datos y asegurar que todos los campos existan
      employeeData = jsonData.map((row) => {
        const processedRow = {}
        requiredFields.forEach((field) => {
          processedRow[field] = row[field] || ""
        })
        return processedRow
      })

      // Cambiar a vista de tabla
      showTable()
    } catch (error) {
      alert("Error al procesar el archivo Excel: " + error.message)
    }
  }

  reader.readAsArrayBuffer(currentFile)
}

function showTable() {
  // Ocultar pantalla de upload y mostrar tabla
  uploadScreen.classList.add("hidden")
  tableScreen.classList.remove("hidden")

  // Crear encabezados de tabla
  const headerRow = document.createElement("tr")
  requiredFields.forEach((field) => {
    const th = document.createElement("th")
    th.textContent = field
    th.style.width = "150px" // Ancho inicial

    // Agregar handle para redimensionar
    const resizeHandle = document.createElement("div")
    resizeHandle.className = "resize-handle"
    th.appendChild(resizeHandle)

    // Event listeners para redimensionar
    let isResizing = false
    resizeHandle.addEventListener("mousedown", (e) => {
      isResizing = true
      document.addEventListener("mousemove", resize)
      document.addEventListener("mouseup", stopResize)
      e.preventDefault()
    })

    function resize(e) {
      if (!isResizing) return
      const rect = th.getBoundingClientRect()
      const width = e.clientX - rect.left
      if (width > 50) {
        // Ancho mínimo
        th.style.width = width + "px"
      }
    }

    function stopResize() {
      isResizing = false
      document.removeEventListener("mousemove", resize)
      document.removeEventListener("mouseup", stopResize)
    }

    headerRow.appendChild(th)
  })

  tableHead.innerHTML = ""
  tableHead.appendChild(headerRow)

  // Crear filas de datos
  tableBody.innerHTML = ""
  employeeData.forEach((row, rowIndex) => {
    const tr = document.createElement("tr")

    requiredFields.forEach((field) => {
      const td = document.createElement("td")
      const input = document.createElement("input")
      input.type = "text"
      input.className = "cell-input"
      input.value = row[field] || ""

      // Event listener para actualizar datos
      input.addEventListener("input", (e) => {
        employeeData[rowIndex][field] = e.target.value
      })

      td.appendChild(input)
      tr.appendChild(td)
    })

    tableBody.appendChild(tr)
  })
}

function sendData() {
  const jsonOutput = JSON.stringify(employeeData, null, 2)
  console.log("JSON Output:", jsonOutput)

  // Crear y descargar archivo JSON
  const blob = new Blob([jsonOutput], { type: "application/json" })
  const url = URL.createObjectURL(blob)
  const a = document.createElement("a")
  a.href = url
  a.download = "employee_data.json"
  document.body.appendChild(a)
  a.click()
  document.body.removeChild(a)
  URL.revokeObjectURL(url)

  alert("Datos enviados y descargados como JSON")
}

</script>
</html>
